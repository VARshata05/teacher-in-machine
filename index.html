<!DOCTYPE html>
<html lang="kn">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Automatic Kids Word Master</title>

  <style>
    :root {
    --primary: #4f46e5;
    --secondary: #f97316;
    --accent: #fde047;
    --success: #22c55e;
    --wrong: #ef4444;
    --bg1: #eef2ff;
    --bg2: #fef3c7;
    }

    body {
    font-family: 'Comic Sans MS', cursive;
    background: linear-gradient(135deg, var(--bg1), var(--bg2));
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    margin: 0;
    }

    .app-container {
    background: white;
    padding: 1.8rem;
    border-radius: 28px;
    width: 420px;
    min-height: 560px;
    box-shadow: 0 25px 50px rgba(0,0,0,0.15);
    border: 6px solid var(--accent);
    display: flex;
    flex-direction: column;
    text-align: center;
    }

    .hidden { display: none !important; }

    /* MENU */
    .menu-card {
    background: linear-gradient(135deg, #e0f2fe, #fef9c3);
    border-radius: 18px;
    padding: 18px;
    cursor: pointer;
    margin-bottom: 15px;
    box-shadow: 0 8px 15px rgba(0,0,0,0.1);
    transition: transform 0.25s ease;
    }
    .menu-card:hover {
    transform: scale(1.05);
    }

    /* STATS */
    .stats {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
    font-size: 18px;
    }

    .progress-bg {
    background: #e5e7eb;
    height: 14px;
    width: 65%;
    border-radius: 10px;
    overflow: hidden;
    }
    #progress-bar {
    height: 100%;
    width: 0%;
    background: linear-gradient(90deg, #22c55e, #4ade80);
    transition: width 0.6s ease;
    }

    /* IMAGE CARD */
    .image-card {
    background: #f8fafc;
    border-radius: 20px;
    padding: 15px;
    margin: 10px auto;
    width: 200px;
    height: 200px;
    box-shadow: inset 0 0 0 4px #e0f2fe;
    display: flex;
    align-items: center;
    justify-content: center;
    }

    #word-image {
    max-width: 160px;
    max-height: 160px;
    object-fit: contain;
    }

    /* WORD TEXT */
    #word-text {
    font-size: 44px;
    font-weight: bold;
    color: #1e293b;
    margin: 10px 0 5px;
    }

    #phonetic-text {
    font-size: 22px;
    color: #2563eb;
    }

    #meaning-text {
    font-size: 20px;
    color: #16a34a;
    }

    /* MIC */
    .mic-indicator {
    font-size: 42px;
    margin: 12px 0;
    color: #94a3b8;
    }
    .mic-active {
    color: var(--secondary);
    animation: pulse 1s infinite;
    }

    @keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.25); }
    100% { transform: scale(1); }
    }

    /* FEEDBACK */
    #feedback {
    margin-top: 10px;
    min-height: 60px;
    font-size: 1.2rem;
    }

    .success-text {
    color: var(--success);
    animation: pop 0.5s ease;
    }
    .error-text {
    color: var(--wrong);
    }

    @keyframes pop {
    0% { transform: scale(0.8); opacity: 0; }
    100% { transform: scale(1); opacity: 1; }
    }

    /* BUTTONS */
    .btn-audio {
    background: linear-gradient(135deg, #6366f1, #3b82f6);
    color: white;
    border: none;
    padding: 12px;
    border-radius: 14px;
    font-weight: bold;
    cursor: pointer;
    margin-bottom: 10px;
    }
    .btn-home {
    background: #475569;
    color: white;
    border: none;
    padding: 12px;
    border-radius: 14px;
    margin-top: auto;
    cursor: pointer;
    }
</style>

</head>

<body>

<div class="app-container">

  <!-- MENU -->
  <div id="menu-screen">
    <h1 style="color:#0369a1;">‡≤®‡≤Æ‡≤∏‡≥ç‡≤ï‡≤æ‡≤∞!</h1>
    <div class="menu-card" onclick="startTask('listen')">
      <h3>üéß Listen Word</h3>
      <p>‡≤ï‡≥á‡≤≥‡≤ø ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤π‡≥á‡≤≥‡≤ø</p>
    </div>
    <div class="menu-card" onclick="startTask('read')">
      <h3>üëÅÔ∏è Read and Speak</h3>
      <p>‡≤ì‡≤¶‡≤ø ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤π‡≥á‡≤≥‡≤ø</p>
    </div>
  </div>

  <!-- GAME -->
  <div id="game-screen" class="hidden">
    <div class="stats">
      <span>‚≠ê <span id="star-count">0</span></span>
      <div class="progress-bg"><div id="progress-bar"></div></div>
    </div>

    <div class="image-card">
        <img id="word-image" />
    </div>

    <h1 id="word-text">WORD</h1>

    <!-- ADDED: Kannada phonetic & meaning -->
    <p id="phonetic-text" style="color:#0284c7;font-size:20px;"></p>
    <p id="meaning-text" style="color:#16a34a;font-size:18px;"></p>

    <div id="mic-icon" class="mic-indicator">üé§</div>
    <div id="feedback">‡≤∏‡≤ø‡≤¶‡≥ç‡≤ß‡≤∞‡≤æ‡≤ó‡≤ø...</div>

    <button id="audio-btn" class="btn-audio" onclick="playAudioManual()">üîä Listen Again</button>
    <button class="btn-home" onclick="location.reload()">üè† Home</button>
  </div>

  <!-- FINAL -->
  <div id="score-screen" class="hidden">
    <h1>üéä ‡≤Ö‡≤≠‡≤ø‡≤®‡≤Ç‡≤¶‡≤®‡≥Ü‡≤ó‡≤≥‡≥Å! üéä</h1>
    <div style="font-size:60px;margin:20px 0;">‚≠ê <span id="final-stars">0</span></div>
    <button onclick="location.reload()" style="background:var(--success);color:white;border:none;padding:15px;border-radius:15px;width:100%;cursor:pointer;font-weight:bold;">‡≤Æ‡≤§‡≥ç‡≤§‡≥Ü ‡≤Ü‡≤ü‡≤µ‡≤æ‡≤°‡≤ø</button>
  </div>

</div>

<script>
/* ================= DATA LOADING (CHANGED) ================= */
let allWords = [];
let tasks = [];
let currentTask = 0;
let currentIndex = 0;
let stars = 0;
let currentMode = '';
let silentTimer;

// Load words from Excel-generated JSON
fetch("words.json")
  .then(res => res.json())
  .then(data => {
    allWords = data;

    // Split into 5 tasks of 5 words
    for (let i = 0; i < allWords.length; i += 5) {
      tasks.push(allWords.slice(i, i + 5));
    }
  });

/* ================= SPEECH ================= */
const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
recognition.lang = 'en-US';

/* ================= START ================= */
function startTask(mode) {
  currentMode = mode;
  document.getElementById('menu-screen').classList.add('hidden');
  document.getElementById('game-screen').classList.remove('hidden');
  updateUI();
}

function playAudioManual() {
  const msg = new SpeechSynthesisUtterance(tasks[currentTask][currentIndex].word);
  speechSynthesis.speak(msg);
}

function processStep() {
  clearTimeout(silentTimer);

  if (currentMode === 'listen') {
    const msg = new SpeechSynthesisUtterance(tasks[currentTask][currentIndex].word);
    msg.onend = startAutoListening;
    speechSynthesis.speak(msg);
  } else {
    document.getElementById('feedback').innerText = "‡≤®‡≥ã‡≤°‡≤ø ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤π‡≥á‡≤≥‡≤ø...";
    startAutoListening();
  }
}

function startAutoListening() {
  try {
    recognition.start();
    document.getElementById('mic-icon').classList.add('mic-active');

    silentTimer = setTimeout(() => {
      recognition.stop();
      document.getElementById('feedback').innerText = "‡≤Æ‡≤§‡≥ç‡≤§‡≥Ü ‡≤™‡≥ç‡≤∞‡≤Ø‡≤§‡≥ç‡≤®‡≤ø‡≤∏‡≤ø...";
      setTimeout(processStep, 1500);
    }, 4000);
  } catch(e) {}
}

recognition.onresult = (event) => {
  clearTimeout(silentTimer);
  document.getElementById('mic-icon').classList.remove('mic-active');

  const result = event.results[0][0].transcript.toLowerCase();
  const target = tasks[currentTask][currentIndex].word.toLowerCase();

  if (result.includes(target)) {
    stars++;
    currentIndex++;

    // TASK & MODE SWITCHING (CORE CHANGE)
    if (currentIndex === 5) {
      currentIndex = 0;

      if (currentMode === 'listen') {
        currentMode = 'read';
        document.getElementById('feedback').innerHTML =
          "<span class='success-text'>üéß Listen completed!</span>";
      } else {
        currentMode = 'listen';
        currentTask++;
        document.getElementById('feedback').innerHTML =
          `<span class='success-text'>üéâ Task ${currentTask} completed!</span>`;
      }
    }

    setTimeout(updateUI, 2000);
  } else {
    document.getElementById('feedback').innerHTML =
      "<span class='error-text'>‚ùå ‡≤Æ‡≤§‡≥ç‡≤§‡≥Ü ‡≤™‡≥ç‡≤∞‡≤Ø‡≤§‡≥ç‡≤®‡≤ø‡≤∏‡≤ø</span>";
    setTimeout(processStep, 2000);
  }
};

/* ================= UI UPDATE ================= */
function updateUI() {
  if (currentTask < tasks.length) {
    const data = tasks[currentTask][currentIndex];

    document.getElementById('star-count').innerText = stars;
    document.getElementById('progress-bar').style.width =
      ((currentTask * 5 + currentIndex) / allWords.length) * 100 + "%";

    document.getElementById('word-image').src =
      data.img || "https://cdn-icons-png.flaticon.com/512/1828/1828884.png";

    document.getElementById('word-text').innerText = data.word.toUpperCase();
    document.getElementById('phonetic-text').innerText = data.phonetic || "";
    document.getElementById('meaning-text').innerText = data.meaning || "";

    document.getElementById('audio-btn').className =
      (currentMode === 'listen') ? 'btn-audio' : 'hidden';

    setTimeout(processStep, 1000);
  } else {
    showFinalScore();
  }
}

function showFinalScore() {
  document.getElementById('game-screen').classList.add('hidden');
  document.getElementById('score-screen').classList.remove('hidden');
  document.getElementById('final-stars').innerText = stars;
}
</script>

</body>
</html>
